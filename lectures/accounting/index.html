<h1>Аккаунтинг</h1>
<p>Created Четверг 20 апреля 2023</p>
<h2>Аккаунтинг</h2>
<p>Для предоставления доступа клиенту сети к функционалу развернутх на платформе чейнкодов, была выбрана модель основанная на учетной записи. Каждый клиент проходит процедуру KYC, по завершению которой, администратором создается учетная запись или аккаунт в системном чейнкоде ACL. Учетная запись или аккаунт определяется уникальным идентификатором пользователя - адрес клиента, связанным с публичным ключом ED25519, который используется для подтверждения личности клиента сети.</p>
<p>Аккаунты бывают однопользовательские и многопользовательские. Однопользовательские - классические аккаунты, где в качестве владельца выступает одна персона и для доступа к учетной записи леджера нужен один ключ. Многопользовательские аккаунты используются для реализации доступа к единой учетной записи нескольких персон, которые находятся в недоверительных отношениях. При этом решается какое число персон необходимо для обеспечения общего консенсуса и доступа к учетной записи аккаунта. Иными словами - сколько надо подписей - N из всего зарегистрированных M участников аккаунта, для того что бы была транзакция прошла проверку и операция была исполнена. Создание многопользовательского аккаунта см раздел фаундейшн ACL.</p>
<p>рассмотрим подробнее:</p>
<h2>Жизненный цикл аккаунта.</h2>
<p>KYC регистрация, использование, серая блокировка, черная блокировка.</p>
<h3>1. KYC регистрация</h3>
<p>Атомайз производит регистрацию новых пользователей в системе. Этот процесс может быть как формальным или вырожденным, так и полноценным - в зависимости от решаемой проектом задачи и обеспечивается организационными процедцрами так сказать в офчейн. В любом случае, для того что бы новый пользователь получил возможность взаимодействовать с атомайз, он должен быть добавлен в базу данных ACL - чейнкод в отрытом одноименном канале, который ведет базу пользователей, а так же управляет их доступом к системе. После генерации пары ключей, администратор платформы вызывает функцию добавления нового пользователя атомайз, передавая публичный ключ клиента.
https://gitlab.project-karma.com/atomyze/library/test/dummy-cc/-/blob/master/public/acl/acl/token/acl_cc.go#L162
генерится уникальный адрес клиента на основе публичного ключа
https://gitlab.project-karma.com/atomyze/library/test/dummy-cc/-/blob/master/public/acl/acl/token/acl_cc.go#L188 - 190</p>
<p>Адрес клиента  - уникальный идентификатор, изначально рассчитывается как f(publicKey) и так как публичный ключ уникален, то адрес так же уникален. Вообще адрес мог бы быть простым счетчиком, но был выбран такой вариант генерации, как безопасный и не требующий вести итераторы. Связь между публичным ключом и адресом является логической, так как предполагается возможность замены ключа при его потере, но об этом поговорим чуть позже.</p>
<h3>2. использование</h3>
<p>Аккаунт представляет собой строку base58check, не меняется и не может быть удален из системы. Фактически он идентифицирует сторону или человека.  Используется для формирования композитных ключей в стейте каналов атомайз - на основе этого строится управление балансами пользователя. Управление балансами пользователя реализован как набор интерфейсов, и используется в реализации смартконтрактов по аналогии с ERC20. Мы посмотрим их подробнее чуть позже.
Аккаунт так же используется для именования или указания участвующей в каком либо процессе стороны. Например - если хотим иметь возможность передать активы от одного пользователя к другому, то реализуется функция в чейнкоде и одним из ее параметров будет адрес целевого пользователя.</p>
<h3>3. серая блокировка, черная блокировка</h3>
<p>TODO заполнить</p>
<h2>Жизненный цикл ключа</h2>
<p>Жизненный цикл ключа можно кратко описать как генерацию, распространение, хранение, использование, восстановление (при необходимости) и прекращение действия.</p>
<h3>Генерация и хранение</h3>
<p>Генерация производится согласно политике проекта, основанном на системе атомайз, в зависимости от решаемой задачи и обеспечиваемом уровне клиентского комфорта. Возможны варианты:</p>
<ol>
<li>самый простой - генерация на стороне клиента и дальнейшее хранение, организуемое самостоятельно.</li>
<li>генерация на стороне площадки с возможным предоставлением доступа к закрытому и сертифицированному хранилищу приватного ключа.
Разница между подходами может быть в удобстве использования платформы, что проявляется в случае высокой активности клиента и необходимости подписывать большое количество транзакций, но так же имеет заметную разницу в уровне безопасности.</li>
</ol>
<h3>Распространение</h3>
<p>Требуется обеспечить защищенный канал передачи данных в область хранения, в случае если клиент не хранит ключи локально после генерации.</p>
<h3>Использование  ключей - авторизация пользователя</h3>
<p>Взаимодействие клиента с чейнкодом происходит посредством транзакций. Формируется структурированный пакет информации (набор байт). Приватным ключом клиента производится подпись пакета, после чего эти данные передаются в качестве аргументов функции invoke соотвествующего чейнкода.
На уровне чейнкода, каждая транзакция проходит процедуру проверки, используя публичный ключ  через поиск записи в ACL, определятся аккаунт клиента совершающего действие, а так же проверяется его подпись - авторизация желаемой операции.
https://gitlab.project-karma.com/atomyze/library/go/foundation/-/blob/master/core/core.go#L237
В случае успешной проверки, управление передается на функцию чейнкода.</p>
<h3>Восстановление</h3>
<p>Так как у нас не анонимная система и каждый пользователь проходит процесс KYC, то платформа берет на себя ответственность за утерянные ключи и позволяет пользователю восстановить доступ к своим активам. Данный процесс может быть использован или проигнорирован в реализуемом проекте на базе атомайз, так как требует поределенных усилий в плане проверки личности клиентов.
пЕсли мы релизуем данный процесс, то нам понадобится</p>
<ol>
<li>служба KYC - проверяющая физическое лицо и связывающая его личность с адресом аккаунта.</li>
<li>Консорциум - группа (один и более) ответственных сторон, заинтересованных в невозможности дискредетировать платформу.</li>
</ol>
<p>Группа может быть вырожденной и составлять 1 сторону, стороной могут выступать как администратор проекта, так и группа валидаторов - администраторов организаций, участвующих в  валидации транзакции по ендорсмент полиси. Пример такого консорциума - группа банков, которые заинтересованы в том что бы клиентская БД не была дискредетирована. Для данной группы формируется мультиподписной адрес, который прописывается в чейнкоде ACL.</p>
<p>Для восстановления ключа пользователя выполняется следующий алгоритм:</p>
<ol>
<li>Клиент связывается со службой KYC и сообщает что ключ от адреса такого-то утерян.</li>
<li>Администратор блокирует адрес - заносит адрес в серый список, до решения службы KYC.</li>
<li>Служба KYC производит проверку пользователя, проверяет данные.</li>
<li>Клиент получает новую пару ключей согласно политике проекта (генерит сам или получает от администратора)</li>
<li>Консорциум формирует мультиподписную транзакцию по замене ключа и вызывает соответсвующую функцию ACL, где указаны адрес клиента, его новый ключ.</li>
<li>Разблокировка адреса клиента.
В случае если на каком-то этапе выясняется что проверка не прошла, аккаунт разблокируется из серого списка.</li>
</ol>
<p>По сути этот процесс можно описать примером из нашей жизни. Гражданин теряет ключ от квартиры, идет в жек с документами, там выделяют мастера, который меняет замок, при этом адрес гражданина вовсе не меняется, а остается прежним.</p>
<h3>Прекращение действия</h3>
<p>Ключи бессрочные, так что прекращение действия возможно только в случае замены ключа или глобальной блокировки самого аккаунта.</p>
